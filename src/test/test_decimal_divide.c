#include <magica/test.h>
#include <magica/decimal.h>

static void divide_test(const char *text1, const char *text2, const char *ret)
{
	char strbuf[1024];
	mg_decimal value1, value2, value3, value4;

	MG_OK(mg_decimal_parse_string(text1, &value1));
	MG_OK(mg_decimal_parse_string(text2, &value2));

	MG_OK(mg_decimal_divide(&value1, &value2, /*out*/&value3));

	MG_OK(mg_decimal_parse_string(ret, &value4));

	MG_OK(mg_decimal_to_string(&value3, strbuf, 1024, NULL));
	
	//MG_DEBUG("%s\n", strbuf);

	MG_ASSERT(mg_decimal_compare(&value3, &value4) == 0);
}

void test_decimal_divide()
{
	MG_TEST_BEGIN();

	divide_test("11111111", "10", "1111111.1");
	divide_test("11111111", "1000", "11111.111");
	divide_test("-111111111111111111111", "1000", "-111111111111111111.111");
	divide_test("-111111111111111111111", "-1000", "111111111111111111.111");
	divide_test("111111111111111111111", "-1000", "-111111111111111111.111");
	divide_test("1959", "2", "979.5");
	divide_test("1000000000000000000000", "2", "500000000000000000000");
	divide_test("1000000", "3", "333333.333333333333333333333333333333");
	divide_test("9999999999999999999999999999999999", "9999999999999999999999999999999999", "1");
	divide_test("9999999999999999999999999999999999", "1", "9999999999999999999999999999999999");
	divide_test("1", "9999999999999999999999999999999999", "0.0000000000000000000000000000000001");
	divide_test("1678165131.16", "9654.6466879411111111", "173819.4245115224285645781449299988");
	divide_test("8974165.41564", "-8974165564", "-0.0009999999834681008566246683522853713");
	divide_test("11111111111165.41564", "-897411111111.65564", "-12.38129434056335669369266417274998");
	divide_test("11111", "100000000000000000000", "0.00000000000000011111");
	divide_test("987654321009876543210", "987654321009876543210", "1");
	divide_test("98.7654321009876543210", "987654321009.876543210", "0.0000000001");
	divide_test("0.1", "0.1", "1");
	divide_test("0.3", "0.0333333333333333333", "9.000000000000000009");
	divide_test("1", "99999999999999999999999", "0.0000000000000000000000100000000000000000000001");
	divide_test("1000", "912345756978465", "0.000000000001096075684411391403954103459357844");
	divide_test("999999999.9999", "999999999.9999", "1");
	divide_test("980.8", "3.1415926535", "312.198336377985167070292170200352806");
	divide_test("1", "10", "0.1");
	divide_test("1", "100000000000", "0.00000000001");
	divide_test("89718", "8971899798271890987", "0.000000000000009999888765730631310110769348670436");
	divide_test("777", "223", "3.48430493273542600896860986547085201");
	divide_test("123456", "1.05", "117577.142857142857142857142857142857");
	divide_test("123456", "1.08", "114311.111111111111111111111111111111");
	divide_test("123456", "1.10", "112232.727272727272727272727272727272");
	divide_test("123456", "0.00000000000000000000000001", "12345600000000000000000000000000");
	divide_test("123456", "0.0001", "1234560000");
	divide_test("0.0000000000000000000001", "0.0000000000000000000001", "1");
	divide_test("0.000001", "2", "0.0000005");
	divide_test("0.000001", "4", "0.00000025");
	divide_test("0.000001", "8", "0.000000125");
	divide_test("0.000000000000000000001", "2", "0.0000000000000000000005");
	divide_test("0.000000000000000000001", "4", "0.00000000000000000000025");
	divide_test("0.000000000000000000001", "8", "0.000000000000000000000125");
	divide_test("-123456", "1.08", "-114311.111111111111111111111111111111");
	divide_test("-123456", "-1.08", "114311.111111111111111111111111111111");
	divide_test("123456", "-1.08", "-114311.111111111111111111111111111111");
	divide_test("1", "9999", "0.000100010001000100010001000100010001");
	divide_test("1", "999999", "0.000001000001000001000001000001000001");
	divide_test("1", "99999999999999999", "0.0000000000000000100000000000000001");
	divide_test("100", "9", "11.1111111111111111111111111111111111");
	divide_test("0.000000000000000000000000000000001", "4", "0.00000000000000000000000000000000025");
	divide_test("0.00000000000000000000000000000001", "4", "0.0000000000000000000000000000000025");
	divide_test("0.00000000000000000000000000000010", "4", "0.000000000000000000000000000000025");
	divide_test("0.00000000000000000000000000000100", "4", "0.00000000000000000000000000000025");
	divide_test("100000000000000000000000000", "100000000000000000000000000", "1");
	divide_test("100000000000000000000000000", "10000000000000000000000", "10000");
	divide_test("100000000000000000000000000", "100000000000000000", "1000000000");
	divide_test("100000000000000000000000000", "100000000000000", "1000000000000");
	divide_test("100000000000000000000000000", "1000000000000", "100000000000000");
	divide_test("100000000000000000000000000", "1000000", "100000000000000000000");
	divide_test("100000000000000000000000000", "10", "10000000000000000000000000");
	divide_test("100000000000000000000000000", "100000000000000000000000000", "1");
	divide_test("10000000000000000000000", "100000000000000000000000000", "0.0001");
	divide_test("100000000000000000", "100000000000000000000000000", "0.000000001");
	divide_test("100000000000000", "100000000000000000000000000", "0.000000000001");
	divide_test("1000000000000", "100000000000000000000000000", "0.00000000000001");
	divide_test("1000000", "100000000000000000000000000", "0.00000000000000000001");
	divide_test("10", "100000000000000000000000000", "0.0000000000000000000000001");
	divide_test("10000000000000000000000", "10000000000000000000000", "1");
	divide_test("10000000000000000000000", "100000000000000000", "100000");
	divide_test("10000000000000000000000", "100000000000000", "100000000");
	divide_test("10000000000000000000000", "1000000000000", "10000000000");
	divide_test("10000000000000000000000", "1000000", "10000000000000000");
	divide_test("10000000000000000000000", "10", "1000000000000000000000");
	divide_test("10000000000000000000000", "10000000000000000000000", "1");
	divide_test("100000000000000000", "10000000000000000000000", "0.00001");
	divide_test("100000000000000", "10000000000000000000000", "0.00000001");
	divide_test("1000000000000", "10000000000000000000000", "0.0000000001");
	divide_test("1000000", "10000000000000000000000", "0.0000000000000001");
	divide_test("10", "10000000000000000000000", "0.000000000000000000001");
	divide_test("100000000000000000", "100000000000000000", "1");
	divide_test("100000000000000000", "100000000000000", "1000");
	divide_test("100000000000000000", "1000000000000", "100000");
	divide_test("100000000000000000", "1000000", "100000000000");
	divide_test("100000000000000000", "10", "10000000000000000");
	divide_test("100000000000000000", "100000000000000000", "1");
	divide_test("1000000000000", "100000000000000000", "0.00001");
	divide_test("1000000", "100000000000000000", "0.00000000001");
	divide_test("10", "100000000000000000", "0.0000000000000001");
	divide_test("10000000000000", "10000000000000", "1");
	divide_test("10000000000000", "1000000", "10000000");
	divide_test("10000000000000", "10", "1000000000000");
	divide_test("10000000000000", "10000000000000", "1");
	divide_test("1000000", "10000000000000", "0.0000001");
	divide_test("10", "10000000000000", "0.000000000001");
	divide_test("10000000", "10000000", "1");
	divide_test("10000000", "10000", "1000");
	divide_test("10000000", "10", "1000000");
	divide_test("10000000", "10000000", "1");
	divide_test("10000", "10000000", "0.001");
	divide_test("10", "10000000", "0.000001");
	divide_test("10000000", "10000000", "1");
	divide_test("10000000", "10000", "1000");
	divide_test("10000000", "10", "1000000");
	divide_test("10000000", "10000000", "1");
	divide_test("10000", "10000000", "0.001");
	divide_test("10", "10000000", "0.000001");
	
	MG_TEST_END();
}
